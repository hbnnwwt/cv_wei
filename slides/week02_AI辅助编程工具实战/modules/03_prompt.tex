%=============================================================================
% 模块三：Prompt工程学精讲 (约 15 页)
%=============================================================================

\section{Prompt工程精讲}

% -----------------------------------------------------------------------------
% 1. RTF 结构化Prompt框架
% -----------------------------------------------------------------------------

\begin{frame}{结构化Prompt框架：RTF 模式}
	\begin{center}
		\begin{tikzpicture}
			\node[draw, fill=red!20] (role) at (0,0) {\shortstack{\textbf{R}ole\\角色}};
			\node[draw, fill=green!20] (task) at (4,0) {\shortstack{\textbf{T}ask\\任务}};
			\node[draw, fill=blue!20] (format) at (8,0) {\shortstack{\textbf{F}ormat\\格式}};

			\draw[->, thick] (role) -- (task) node[midway, above] {定义};
			\draw[->, thick] (task) -- (format) node[midway, above] {指定};
		\end{tikzpicture}
	\end{center}

	\vspace{0.3cm}

	\begin{exampleblock}{RTF 模板示例}
		\textbf{Role (角色)：} 你是一个资深计算机视觉算法专家，精通 OpenCV 和图像处理。

		\vspace{0.2cm}

		\textbf{Task (任务)：} 实现试卷图像的二值化，要求能自适应处理光照不均的情况。

		\vspace{0.2cm}

		\textbf{Format (格式)：}
		\begin{itemize}
			\item 返回带有详细 Docstring 的 Python 函数
			\item 包含输入输出示例
			\item 列出关键参数的调优建议
		\end{itemize}
	\end{exampleblock}
\end{frame}

% -----------------------------------------------------------------------------
% 1.5 三个理解层级（新增）
% -----------------------------------------------------------------------------

\begin{frame}{三个理解层级：RTF框架}
	\begin{columns}
		\column{0.33\textwidth}
		\begin{block}{基础概念}
			\textbf{目标：}理解RTF是什么

			\vspace{0.2cm}

			\textbf{核心问题：}
			\begin{itemize}
				\item R、T、F分别代表什么？
				\item 为什么需要结构化Prompt？
				\item 每个部分的作用是什么？
			\end{itemize}

			\vspace{0.2cm}

			\textbf{适合：}初学者
		\end{block}

		\column{0.33\textwidth}
		\begin{exampleblock}{可视化演示}
			\textbf{目标：}看到RTF的效果

			\vspace{0.2cm}

			\textbf{对比实验：}
			\begin{itemize}
				\item 对比基础Prompt vs RTF优化Prompt
				\item 观察AI输出的差异
				\item 分析哪个效果更好
			\end{itemize}

			\vspace{0.2cm}

			\textbf{实践：}修改Prompt结构

			\vspace{0.2cm}

			\textbf{适合：}有一定基础的学习者
		\end{exampleblock}

		\column{0.33\textwidth}
		\begin{alertblock}{扩展应用}
			\textbf{目标：}设计自己的RTF Prompt

			\vspace{0.2cm}

			\textbf{创新任务：}
			\begin{itemize}
				\item 针对实际问题设计Prompt
				\item 优化Prompt结构提高效率
				\item 分享最佳实践
			\end{itemize}

			\vspace{0.2cm}

			\textbf{适合：}进阶学习者
		\end{alertblock}
	\end{columns}

	\vspace{0.5cm}

	\begin{center}
		\textit{提示：根据自身水平选择合适的理解层级，也可以从基础开始逐步进阶}
	\end{center}
\end{frame}

\begin{frame}{RTF 框架实战对比}
	\begin{columns}
		\column{0.5\textwidth}
		\begin{alertblock}{[\times] 不好的 Prompt}
			帮我写个代码处理图像。
		\end{alertblock}

		\vspace{0.3cm}

		\textbf{问题分析：}
		\begin{itemize}
			\item 没有定义角色
			\item 任务模糊
			\item 没有格式要求
		\end{itemize}

		\column{0.5\textwidth}
		\begin{exampleblock}{[\checkmark] 好的 Prompt (RTF)}
			\textbf{Role：}你是一位有10年经验的计算机视觉工程师，精通OpenCV。

			\vspace{0.2cm}

			\textbf{Task：}请编写一个Python函数，实现答题卡图像的自适应二值化。

			\vspace{0.2cm}

			\textbf{Format：}
			\begin{itemize}
				\item 提供完整的、可运行的代码
				\item 包含详细的函数文档
				\item 解释关键参数的设置依据
			\end{itemize}
		\end{exampleblock}
	\end{columns}
\end{frame}

% -----------------------------------------------------------------------------
% 2. Chain-of-Thought (思维链)
% -----------------------------------------------------------------------------

\begin{frame}{进阶技巧：Chain-of-Thought (思维链)}
	\begin{block}{什么是思维链？}
		让 AI \textbf{"一步一步思考"}（Step by Step），而不是直接给出答案。
	\end{block}

	\vspace{0.3cm}

	\begin{columns}
		\column{0.5\textwidth}
		\begin{alertblock}{[\times] 直接给答案}
			\textbf{Prompt：} 用 OpenCV 实现透视变换矫正倾斜的试卷。

			\vspace{0.2cm}

			\textbf{问题：}
			\begin{itemize}
				\item AI 直接扔出代码
				\item 学生不理解原理
			\end{itemize}
		\end{alertblock}

		\column{0.5\textwidth}
		\begin{exampleblock}{[\checkmark] 思维链引导}
			\textbf{Prompt：} 请一步一步教我如何用OpenCV实现透视变换：
			\begin{enumerate}
				\item 首先解释什么是透视变换
				\item 然后说明需要哪些输入参数
				\item 接着给出实现步骤
				\item 最后提供完整代码
			\end{enumerate}
		\end{exampleblock}
	\end{columns}
\end{frame}

\begin{frame}{不同类型Prompt对比：代码生成}
	\begin{columns}
		\column{0.5\textwidth}
		\textbf{功能描述：}
		\begin{itemize}
			\item 清晰说明要实现什么功能
			\item 描述输入和输出
			\item 指定技术栈
		\end{itemize}

		\vspace{0.3cm}

		\textbf{代码要求：}
		\begin{itemize}
			\item 代码风格规范
			\item 错误处理机制
			\item 性能要求
		\end{itemize}

		\column{0.5\textwidth}
		\begin{exampleblock}{代码生成Prompt示例}
			\textbf{角色：}你是一位Python开发者。

			\vspace{0.2cm}

			\textbf{任务：}请帮我写一个读取CSV文件的Python函数。

			\vspace{0.2cm}

			\textbf{输入/输出：}
			\begin{itemize}
				\item 输入：CSV文件路径
				\item 输出：pandas DataFrame
			\end{itemize}

			\vspace{0.2cm}

			\textbf{要求：}
			\begin{itemize}
				\item 使用pandas库
				\item 处理文件不存在的情况
				\item 返回DataFrame对象
			\end{itemize}
		\end{exampleblock}
	\end{columns}
\end{frame}

\begin{frame}[fragile]{不同类型Prompt对比：代码解释与调试}
	\begin{columns}
		\column{0.5\textwidth}
		\textbf{代码解释Prompt：}
		\begin{itemize}
			\item 粘贴代码
			\item 逐行解释要求
			\item 关键参数说明
			\item 可能的错误用法
		\end{itemize}

		\vspace{0.3cm}

		\textbf{调试求助Prompt：}
		\begin{itemize}
			\item 粘贴代码
			\item 错误信息
			\item 预期行为
			\item 上下文说明
		\end{itemize}

		\column{0.5\textwidth}
		\begin{exampleblock}{代码解释Prompt示例}
			请解释以下代码的作用：

			\begin{lstlisting}[language=Python, basicstyle=\ttfamily\tiny]
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
blur = cv2.GaussianBlur(gray, (5, 5), 0)
edges = cv2.Canny(blur, 50, 150)
			\end{lstlisting}

			\vspace{0.2cm}

			要求：
			\begin{itemize}
				\item 逐行解释每行代码的作用
				\item 说明关键参数的含义
				\item 解释为什么要按这个顺序处理
			\end{itemize}
		\end{exampleblock}
	\end{columns}
\end{frame}

\begin{frame}{Prompt优化技巧：少样本提示（Few-Shot）}
	\begin{block}{什么是少样本提示？}
		提供1-3个示例，让AI通过模仿学习来完成任务。
	\end{block}

	\vspace{0.3cm}

	\begin{columns}
		\column{0.5\textwidth}
		\begin{alertblock}{[\times] 零样本（Zero-Shot）}
			\textbf{Prompt：}
			请将以下中文翻译成英文。

			\vspace{0.2cm}

			输入：计算机视觉
		\end{alertblock}

		\vspace{0.3cm}

		\textbf{问题：}
		\begin{itemize}
			\item AI可能输出多种翻译
			\item 风格不一致
			\item 质量不稳定
		\end{itemize}

		\column{0.5\textwidth}
		\begin{exampleblock}{[\checkmark] 少样本（Few-Shot）}
			\textbf{Prompt：}
			请将以下中文翻译成英文。参考示例：

			\vspace{0.2cm}

			示例1：
			\begin{itemize}
				\item 输入：人工智能
				\item 输出：Artificial Intelligence
			\end{itemize}

			\vspace{0.2cm}

			示例2：
			\begin{itemize}
				\item 输入：深度学习
				\item 输出：Deep Learning
			\end{itemize}

			\vspace{0.2cm}

			现在请翻译：
			\begin{itemize}
				\item 输入：计算机视觉
			\end{itemize}
		\end{exampleblock}
	\end{columns}
\end{frame}

\begin{frame}{Prompt优化技巧：思维链（Chain-of-Thought）}
	\begin{columns}
		\column{0.5\textwidth}
		\begin{alertblock}{[\times] 直接提问}
			\textbf{Prompt：}
			请帮我实现试卷透视变换矫正。

			\vspace{0.2cm}

			\textbf{问题：}
			\begin{itemize}
				\item 可能缺少关键步骤
				\item 换个场景就不会了
			\end{itemize}
		\end{alertblock}

		\column{0.5\textwidth}
		\begin{exampleblock}{[\checkmark] 思维链引导}
			\textbf{Prompt：}

			请帮我实现试卷透视变换矫正。请按以下步骤思考：

			\textbf{Step 1：} 透视变换的数学原理是什么？需要哪些参数？

			\textbf{Step 2：} 如何从图像中自动找到试卷的四个角点？

			\textbf{Step 3：} 请写出完整的 Python 实现代码
		\end{exampleblock}
	\end{columns}
\end{frame}

\begin{frame}{思维链实战：准确率对比}
	\textbf{测试任务：} 用 OpenCV 实现自适应阈值处理

	\vspace{0.3cm}

	\begin{table}
		\centering
		\begin{tabular}{p{3cm}p{4cm}p{4cm}}
			\toprule
			\textbf{Prompt 类型} & \textbf{直接提问} & \textbf{思维链引导} \\
			\midrule
			代码完整度              & 70\%          & 95\%           \\
			参数解释清晰度            & 一般            & 详细             \\
			边界情况处理             & 很少提及          & 全面考虑           \\
			实际运行成功率            & 60\%          & 90\%           \\
			\bottomrule
		\end{tabular}
	\end{table}

	\vspace{0.3cm}

	\begin{exampleblock}{思维链 Prompt 模板}
		请帮我解决 [问题]。请按以下步骤思考：

		\textbf{Step 1：} 分析问题的核心要点是什么？

		\textbf{Step 2：} 有哪些可能的解决方案？各自的优缺点？

		\textbf{Step 3：} 请给出推荐的实现代码
	\end{exampleblock}
\end{frame}

% -----------------------------------------------------------------------------
% 3. Few-shot (少样本提示)
% -----------------------------------------------------------------------------

\begin{frame}{进阶技巧：Few-shot (少样本提示)}
	\begin{block}{什么是 Few-shot？}
		给 AI 几个 \textbf{正确的例子}，让它模仿你的风格或格式处理新任务。
	\end{block}

	\vspace{0.3cm}

	\begin{columns}
		\column{0.5\textwidth}
		\textbf{示例场景：} OpenCV 图像转换

		\vspace{0.2cm}

		\begin{exampleblock}{Few-shot Prompt}
			请模仿以下示例的代码风格和注释规范：

			\vspace{0.2cm}

			\textbf{示例 1 - 灰度化：}

			\texttt{\# 读取图像并转换为灰度图}

			\texttt{\# 参数：image\_path: 图像文件路径}

			\texttt{\# 返回：gray\_image: 灰度图像数组}

			\texttt{def load\_and\_gray(image\_path):}

			\texttt{~~~img = cv2.imread(image\_path)}

			\texttt{~~~gray = cv2.cvtColor(img, cv2.COLOR\_BGR2GRAY)}

			\texttt{~~~return gray}
		\end{exampleblock}

		\column{0.5\textwidth}
		\textbf{待处理任务：}

		\vspace{0.2cm}

		\begin{exampleblock}{继续 Prompt}
			\textbf{示例 2 - 高斯模糊：}

			\texttt{\# 对图像进行高斯模糊}

			\texttt{\# 参数：image: 输入图像}

			\texttt{\# 返回：blurred: 模糊后的图像}

			\texttt{def gaussian\_smooth(image):}

			\texttt{~~~blurred = cv2.GaussianBlur(image, (5,5), 0)}

			\texttt{~~~return blurred}

			\vspace{0.3cm}

			\textbf{任务：}

			请按照上述风格和规范，实现一个图像边缘检测函数。
		\end{exampleblock}
	\end{columns}
\end{frame}

\begin{frame}{Few-shot 效果对比}
	\begin{table}
		\centering
		\begin{tabular}{p{3cm}p{5cm}p{5cm}}
			\toprule
			\textbf{Prompt 类型} & \textbf{无 Few-shot} & \textbf{有 Few-shot} \\
			\midrule
			代码风格一致性            & 随机，不稳定              & 与示例高度一致             \\
			注释完整度              & 较简略                 & 详细，符合示例规范           \\
			参数说明               & 缺失或不清晰              & 完整的 Docstring       \\
			错误处理               & 经常遗漏                & 按示例模式添加             \\
			代码可读性              & 一般                  & 优秀                  \\
			\bottomrule
		\end{tabular}
	\end{table}

	\vspace{0.3cm}

	\begin{block}{Few-shot 使用技巧}
		\begin{enumerate}
			\item \textbf{示例数量：} 2-3 个示例通常足够
			\item \textbf{示例质量：} 确保示例是正确的、高质量的
			\item \textbf{格式一致：} 示例之间保持风格一致
			\item \textbf{明确指令：} 告诉 AI "请按照示例的风格"
		\end{enumerate}
	\end{block}
\end{frame}

% -----------------------------------------------------------------------------
% 4. 上下文窗口管理
% -----------------------------------------------------------------------------

\begin{frame}{上下文窗口管理}
	\begin{alertblock}{问题：为什么代码太长了 AI 就会"忘掉"前面的内容？}
		\begin{itemize}
			\item 大模型有 \textbf{上下文窗口限制}（通常 4K-128K tokens）
			\item 超出限制后，模型会"遗忘"最早的内容
			\item 导致前后文不一致、回答质量下降
		\end{itemize}
	\end{alertblock}

	\vspace{0.3cm}

	\begin{columns}
		\column{0.5\textwidth}
		\textbf{各模型上下文限制：}
		\begin{table}
			\centering
			\small
			\begin{tabular}{lc}
				\toprule
				\textbf{模型} & \textbf{上下文} \\
				\midrule
				GPT-4       & 8K/32K       \\
				GPT-4o      & 128K         \\
				Claude 3.5  & 200K         \\
				DeepSeek    & 64K          \\
				通义千问        & 128K         \\
				\bottomrule
			\end{tabular}
		\end{table}

		\column{0.5\textwidth}
		\textbf{精简 Prompt 的技巧：}
		\begin{enumerate}
			\item \textbf{只提供必要代码：} 不要贴整个文件
			\item \textbf{使用摘要：} "前面我们讨论了X，现在要解决Y"
			\item \textbf{分段处理：} 长任务拆分成多个短任务
			\item \textbf{定期总结：} 让 AI 总结当前进度
		\end{enumerate}
	\end{columns}
\end{frame}
