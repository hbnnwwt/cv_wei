%=============================================================================
% æ¨¡å—ä¸‰ï¼šOpenCV åŸºç¡€ä¸è¿›é˜¶æ“ä½œ
%=============================================================================

\section{OpenCV åŸºç¡€}

\begin{frame}[fragile]{OpenCV æ ¸å¿ƒå‡½æ•°è¯¦è§£}
	\begin{lstlisting}[title={å›¾åƒè¯»å–çš„éšæ‚£}]
import cv2

# è·¯å¾„åƒä¸‡ä¸èƒ½æœ‰ä¸­æ–‡ï¼ˆæ–°æ‰‹å¸¸è§é”™è¯¯ï¼‰
img = cv2.imread('paper.jpg')

# æ£€æŸ¥æ˜¯å¦è¯»å–æˆåŠŸ
if img is None:
    print("é”™è¯¯ï¼šæ–‡ä»¶ä¸å­˜åœ¨æˆ–è·¯å¾„å«æœ‰ä¸­æ–‡ï¼")

# æ‰“å°ç»´åº¦ (H, W, C)
print(img.shape)
	\end{lstlisting}

	\begin{block}{å¸¸ç”¨ Flag}
		\begin{itemize}
			\item \texttt{cv2.IMREAD\_COLOR}ï¼šåŠ è½½å½©è‰²å›¾ï¼ˆé»˜è®¤ï¼‰
			\item \texttt{cv2.IMREAD\_GRAYSCALE}ï¼šç›´æ¥ä»¥ç°åº¦æ¨¡å¼åŠ è½½
		\end{itemize}
	\end{block}
\end{frame}

\begin{frame}[fragile]{å·¥ç¨‹å®æˆ˜ï¼šå¤„ç†ä¸­æ–‡è·¯å¾„çš„"ç»ˆææ–¹æ¡ˆ"}
	\begin{alertblock}{çœŸå®åœºæ™¯}
		é˜…å·ç³»ç»Ÿä¸­ï¼Œå­¦ç”Ÿå§“åç»å¸¸æ˜¯ä¸­æ–‡ï¼Œæ–‡ä»¶åå¦‚ï¼š\texttt{å¼ ä¸‰\_è¯•å·.jpg}\\
		\texttt{cv2.imread()} ç›´æ¥è¯»å–ä¼šå¤±è´¥ï¼ˆè¿”å› Noneï¼‰
	\end{alertblock}

	\begin{columns}
		\column{0.5\textwidth}
		\textbf{é—®é¢˜åŸå› ï¼š}
		\begin{itemize}
			\item OpenCV çš„ C++ åº“ä¸æ”¯æŒ Unicode è·¯å¾„
			\item ä¸­æ–‡è·¯å¾„ä¼šä¹±ç 
		\end{itemize}

		\vspace{0.3cm}
		\textbf{é”™è¯¯åšæ³•ï¼š}
		\begin{lstlisting}[language=Python, basicstyle=\ttfamily\tiny]
# ç›´æ¥è¯»å–ï¼Œè¿”å› None
img = cv2.imread('å¼ ä¸‰_è¯•å·.jpg')
if img is None:
    print("è¯»å–å¤±è´¥ï¼")
		\end{lstlisting}

		\column{0.5\textwidth}
		\textbf{æ­£ç¡®åšæ³•ï¼š}
		\begin{lstlisting}[language=Python, basicstyle=\ttfamily\tiny]
import cv2
import numpy as np

def imread_chinese(path):
    """è¯»å–ä¸­æ–‡è·¯å¾„çš„å›¾ç‰‡"""
    img_array = np.fromfile(path, 
                            dtype=np.uint8)
    img = cv2.imdecode(img_array, -1)
    return img

# ä½¿ç”¨
img = imread_chinese('å¼ ä¸‰_è¯•å·.jpg')
cv2.imshow('æˆåŠŸï¼', img)
		\end{lstlisting}
	\end{columns}
\end{frame}

\begin{frame}[fragile]{å·¥ç¨‹å®æˆ˜ï¼šä¿å­˜ä¸­æ–‡è·¯å¾„å›¾ç‰‡}
	\textbf{é…å¥—æŠ€å·§ï¼š}ä¿å­˜æ—¶ä¹Ÿæ”¯æŒä¸­æ–‡è·¯å¾„

	\begin{columns}
		\column{0.5\textwidth}
		\begin{lstlisting}[language=Python, basicstyle=\ttfamily\tiny]
import cv2
import numpy as np

def imwrite_chinese(path, img):
    """ä¿å­˜ä¸­æ–‡è·¯å¾„çš„å›¾ç‰‡"""
    is_success, img_buf = cv2.imencode(
        ".jpg", img)
    if is_success:
        img_buf.tofile(path)
        return True
    return False

# ä½¿ç”¨
img = cv2.imread('exam.jpg')
imwrite_chinese('å¤„ç†ç»“æœ_å¼ ä¸‰.jpg', img)
print("ä¿å­˜æˆåŠŸï¼")
		\end{lstlisting}

		\column{0.5\textwidth}
		\textbf{åŸç†è¯´æ˜ï¼š}
		\begin{enumerate}
			\item \textbf{imdecode}ï¼šä»å†…å­˜ä¸­çš„å­—èŠ‚æ•°ç»„è§£ç 
			\item \textbf{imencode + tofile}ï¼šç¼–ç ä¸ºå­—èŠ‚æ•°ç»„åå†™å…¥
		\end{enumerate}

		\vspace{0.3cm}
		\textbf{é˜…å·ç³»ç»Ÿåº”ç”¨ï¼š}
		\begin{itemize}
			\item æ‰¹é‡å¤„ç†å­¦ç”Ÿè¯•å·
			\item ç”Ÿæˆå¸¦å­¦ç”Ÿå§“åçš„ç»“æœæ–‡ä»¶
		\end{itemize}
	\end{columns}
\end{frame}

\begin{frame}[fragile]{AIè¾…åŠ©å®æˆ˜ç¤ºä¾‹ï¼šè§£å†³ä¸­æ–‡è·¯å¾„é—®é¢˜}
	\textbf{åœºæ™¯}: OpenCVæ— æ³•è¯»å–ä¸­æ–‡è·¯å¾„ï¼Œå¦‚ä½•ç”¨AIè§£å†³ï¼Ÿ

	\begin{tcolorbox}[colback=blue!5!white,colframe=blue!50!black,title=ğŸ‘¤ ç”¨æˆ·æé—®]
		\small
		"æˆ‘ç”¨cv2.imreadè¯»å–ä¸­æ–‡è·¯å¾„çš„å›¾ç‰‡è¿”å›Noneï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ"
	\end{tcolorbox}

	\begin{tcolorbox}[colback=green!5!white,colframe=green!50!black,title=ğŸ¤– AIå›ç­”]
		\small
		"OpenCVçš„imreadä¸æ”¯æŒä¸­æ–‡è·¯å¾„ã€‚è§£å†³æ–¹æ³•ï¼š\\
		1. ç”¨numpy.fromfileè¯»å–ä¸ºå­—èŠ‚æ•°ç»„\\
		2. ç”¨cv2.imdecodeè§£ç "
	\end{tcolorbox}

	\begin{lstlisting}[language=Python, basicstyle=\ttfamily\small]
import numpy as np
import cv2

# æ”¯æŒä¸­æ–‡è·¯å¾„çš„è¯»å–æ–¹å¼
img = cv2.imdecode(np.fromfile(path, dtype=np.uint8), -1)
	\end{lstlisting}

	\vspace{0.2cm}
	\small \textbf{AIçš„ä»·å€¼}: å‘Šè¯‰ä½ é—®é¢˜çš„æœ¬è´¨ï¼ˆOpenCVçš„C++åº•å±‚é™åˆ¶ï¼‰ï¼Œç›´æ¥ç»™å‡ºå¯ç”¨ä»£ç ï¼ŒèŠ‚çœæœç´¢æ—¶é—´ã€‚
\end{frame}

\begin{frame}[fragile]{Matplotlib æ˜¾ç¤ºä¸ BGR è½¬æ¢}
	ä¸ºä»€ä¹ˆç”¨ \texttt{plt.imshow} æ˜¾ç¤ºå‡ºæ¥çš„äººè„¸æ˜¯é’è“è‰²çš„ï¼Ÿ

	\begin{lstlisting}[language=Python, basicstyle=\ttfamily\small]
import matplotlib.pyplot as plt

# OpenCV æ˜¯ BGRï¼ŒMatplotlib æ˜¯ RGB
img_rgb = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)

plt.imshow(img_rgb)
plt.show()
	\end{lstlisting}

	\vspace{0.3cm}
	\textbf{æ³¨æ„ï¼š} ç°åº¦å›¾æ˜¾ç¤ºæ—¶éœ€è¦è®¾ç½® \texttt{cmap='gray'}ï¼Œå¦åˆ™ä¼šå˜æˆ"åŸæ²¹è‰²"ã€‚

	\begin{lstlisting}[language=Python, basicstyle=\ttfamily\small]
plt.imshow(gray_img, cmap='gray')
	\end{lstlisting}
\end{frame}

\begin{frame}[fragile]{OpenCVè¿›é˜¶ï¼šå‡ ä½•å˜æ¢}
	\begin{columns}
		\column{0.5\textwidth}
		\textbf{1. å¹³ç§»ï¼ˆTranslationï¼‰}
		\begin{lstlisting}[language=Python, basicstyle=\ttfamily\tiny]
# å‘å³å¹³ç§»100ï¼Œå‘ä¸‹å¹³ç§»50
M = np.float32([
    [1, 0, 100],  # xä½ç§»
    [0, 1, 50]   # yä½ç§»
])
translated = cv2.warpAffine(
    img, M, (w, h)
)
		\end{lstlisting}

		\vspace{0.2cm}
		\textbf{2. æ—‹è½¬ï¼ˆRotationï¼‰}
		\begin{lstlisting}[language=Python, basicstyle=\ttfamily\tiny]
# é€†æ—¶é’ˆæ—‹è½¬30åº¦
center = (w//2, h//2)  # æ—‹è½¬ä¸­å¿ƒ
M = cv2.getRotationMatrix2D(
    center,
    30,     # è§’åº¦ï¼ˆåº¦ï¼‰
    1.0     # ç¼©æ”¾æ¯”ä¾‹
)
rotated = cv2.warpAffine(
    img, M, (w, h)
)
		\end{lstlisting}

		\column{0.5\textwidth}
		\textbf{3. ç¼©æ”¾ï¼ˆScalingï¼‰}
		\begin{lstlisting}[language=Python, basicstyle=\ttfamily\tiny]
# æ”¾å¤§2å€
scaled = cv2.resize(
    img,
    None,
    fx=2.0,
    fy=2.0,
    interpolation=cv2.INTER_CUBIC
)

# æŒ‡å®šå°ºå¯¸ç¼©æ”¾
resized = cv2.resize(
    img,
    (800, 600),  # å®½, é«˜
    interpolation=cv2.INTER_LINEAR
)
		\end{lstlisting}

		\vspace{0.2cm}
		\begin{block}{æ’å€¼æ–¹æ³•é€‰æ‹©}
		\begin{itemize}
			\item æ”¾å¤§ï¼š\texttt{INTER\_CUBIC}ï¼ˆè´¨é‡æœ€å¥½ï¼‰
			\item ç¼©å°ï¼š\texttt{INTER\_AREA}ï¼ˆæŠ—é”¯é½¿ï¼‰
			\item å¿«é€Ÿï¼š\texttt{INTER\_LINEAR}
		\end{itemize}
		\end{block}
	\end{columns}
\end{frame}

\begin{frame}[fragile]{OpenCVè¿›é˜¶ï¼šä»¿å°„å˜æ¢ä¸é€è§†å˜æ¢}
	\begin{columns}
		\column{0.5\textwidth}
		\textbf{ä»¿å°„å˜æ¢ï¼ˆAffine Transformï¼‰}
		\begin{itemize}
			\item ä¿æŒå¹³è¡Œçº¿çš„å¹³è¡Œæ€§
			\item éœ€è¦3ä¸ªç‚¹å¯¹åº”
		\end{itemize}
		\begin{lstlisting}[language=Python, basicstyle=\ttfamily\tiny]
# åŸå›¾åƒçš„3ä¸ªç‚¹
src_pts = np.float32([
    [50, 50],    # å·¦ä¸Š
    [200, 50],   # å³ä¸Š
    [50, 200]    # å·¦ä¸‹
])

# ç›®æ ‡å›¾åƒçš„3ä¸ªç‚¹
dst_pts = np.float32([
    [10, 10],
    [200, 20],
    [10, 200]
])

# è®¡ç®—å˜æ¢çŸ©é˜µ
M = cv2.getAffineTransform(
    src_pts, dst_pts
)

# æ‰§è¡Œå˜æ¢
affine = cv2.warpAffine(
    img, M, (w, h)
)
		\end{lstlisting}

		\column{0.5\textwidth}
		\textbf{é€è§†å˜æ¢ï¼ˆPerspective Transformï¼‰}
		\begin{itemize}
			\item ä¸ä¿æŒå¹³è¡Œæ€§
			\item éœ€è¦4ä¸ªç‚¹å¯¹åº”
			\item \highlight{ä¸‹å‘¨é‡ç‚¹ï¼}
		\end{itemize}
		\begin{lstlisting}[language=Python, basicstyle=\ttfamily\tiny]
# åŸå›¾åƒçš„4ä¸ªè§’ç‚¹
src_pts = np.float32([
    [100, 150],  # å·¦ä¸Š
    [450, 120],  # å³ä¸Š
    [480, 380],  # å³ä¸‹
    [80, 400]    # å·¦ä¸‹
])

# ç›®æ ‡çŸ©å½¢
width, height = 400, 300
dst_pts = np.float32([
    [0, 0],
    [width-1, 0],
    [width-1, height-1],
    [0, height-1]
])

# è®¡ç®—å˜æ¢çŸ©é˜µ
M = cv2.getPerspectiveTransform(
    src_pts, dst_pts
)

# æ‰§è¡Œå˜æ¢
warped = cv2.warpPerspective(
    img, M, (width, height)
)
		\end{lstlisting}
	\end{columns}
\end{frame}

\begin{frame}[fragile]{OpenCVè¿›é˜¶ï¼šå½¢æ€å­¦æ“ä½œåŸºç¡€}
	\textbf{å½¢æ€å­¦æ“ä½œï¼š} åŸºäºå›¾åƒå½¢çŠ¶çš„å˜æ¢ï¼Œå¸¸ç”¨äºäºŒå€¼å›¾åƒ

	\begin{columns}
		\column{0.5\textwidth}
		\textbf{1. è…èš€ï¼ˆErosionï¼‰}
		\begin{itemize}
			\item è†¨èƒ€ç™½è‰²ï¼Œæ”¶ç¼©é»‘è‰²
			\item å»é™¤å°å™ªç‚¹
		\end{itemize}
		\begin{lstlisting}[language=Python, basicstyle=\ttfamily\tiny]
kernel = np.ones((3, 3), np.uint8)
eroded = cv2.erode(binary, kernel, 
                   iterations=1)
		\end{lstlisting}

		\vspace{0.2cm}
		\textbf{2. è†¨èƒ€ï¼ˆDilationï¼‰}
		\begin{itemize}
			\item æ”¶ç¼©ç™½è‰²ï¼Œè†¨èƒ€é»‘è‰²
			\item å¡«å……å°å­”æ´
		\end{itemize}
		\begin{lstlisting}[language=Python, basicstyle=\ttfamily\tiny]
dilated = cv2.dilate(binary, kernel, 
                     iterations=1)
		\end{lstlisting}

		\vspace{0.2cm}
		\textbf{3. å¼€è¿ç®—ï¼ˆOpeningï¼‰}
		\begin{itemize}
			\item å…ˆè…èš€åè†¨èƒ€
			\item å»é™¤å°ç‰©ä½“ï¼Œä¿æŒå¤§ç‰©ä½“
		\end{itemize}
		\begin{lstlisting}[language=Python, basicstyle=\ttfamily\tiny]
opening = cv2.morphologyEx(
    binary, cv2.MORPH_OPEN, kernel
)
		\end{lstlisting}

		\column{0.5\textwidth}
		\textbf{4. é—­è¿ç®—ï¼ˆClosingï¼‰}
		\begin{itemize}
			\item å…ˆè†¨èƒ€åè…èš€
			\item å¡«å……å°å­”æ´ï¼Œè¿æ¥è¿‘é‚»ç‰©ä½“
		\end{itemize}
		\begin{lstlisting}[language=Python, basicstyle=\ttfamily\tiny]
closing = cv2.morphologyEx(
    binary, cv2.MORPH_CLOSE, kernel
)
		\end{lstlisting}

		\vspace{0.2cm}
		\textbf{5. å½¢æ€å­¦æ¢¯åº¦}
		\begin{itemize}
			\item è†¨èƒ€ - è…èš€
			\item æå–è¾¹ç¼˜
		\end{itemize}
		\begin{lstlisting}[language=Python, basicstyle=\ttfamily\tiny]
gradient = cv2.morphologyEx(
    binary, cv2.MORPH_GRADIENT, 
    kernel
)
		\end{lstlisting}

		\vspace{0.2cm}
		\begin{block}{ç»“æ„å…ƒç´ ï¼ˆKernelï¼‰}
		å¯è‡ªå®šä¹‰å½¢çŠ¶ï¼šçŸ©å½¢ã€åå­—å½¢ã€æ¤­åœ†å½¢\\
		å¤§å°å†³å®šå½±å“èŒƒå›´
		\end{block}
	\end{columns}
\end{frame}

\begin{frame}[fragile]{å½¢æ€å­¦æ“ä½œåœ¨é˜…å·ä¸­çš„åº”ç”¨}
	\begin{columns}
		\column{0.5\textwidth}
		\textbf{åœºæ™¯1ï¼šå»é™¤å¡«æ¶‚å™ªç‚¹}
		\begin{itemize}
			\item é—®é¢˜ï¼šå¡«æ¶‚è¾¹ç¼˜æœ‰ç»†å°å™ªç‚¹
			\item è§£å†³ï¼šå¼€è¿ç®—å»é™¤å°å™ªç‚¹
		\end{itemize}
		\begin{lstlisting}[language=Python, basicstyle=\ttfamily\tiny]
# å»é™¤å°å™ªç‚¹
kernel = np.ones((2, 2), np.uint8)
clean_bubble = cv2.morphologyEx(
    binary,
    cv2.MORPH_OPEN,
    kernel
)
		\end{lstlisting}

		\vspace{0.2cm}
		\textbf{åœºæ™¯2ï¼šè¿æ¥æ–­å¼€çš„ç¬”è¿¹}
		\begin{itemize}
			\item é—®é¢˜ï¼šæ‰‹å†™æ•°å­—æ–­å¼€
			\item è§£å†³ï¼šé—­è¿ç®—è¿æ¥
		\end{itemize}
		\begin{lstlisting}[language=Python, basicstyle=\ttfamily\tiny]
# è¿æ¥æ–­å¼€éƒ¨åˆ†
kernel = np.ones((3, 3), np.uint8)
connected = cv2.morphologyEx(
    binary,
    cv2.MORPH_CLOSE,
    kernel
)
		\end{lstlisting}

		\column{0.5\textwidth}
		\textbf{åœºæ™¯3ï¼šæå–è½®å»“è¾¹ç¼˜}
		\begin{itemize}
			\item é—®é¢˜ï¼šéœ€è¦æ¸…æ™°çš„è½®å»“
			\item è§£å†³ï¼šå½¢æ€å­¦æ¢¯åº¦
		\end{itemize}
		\begin{lstlisting}[language=Python, basicstyle=\ttfamily\tiny]
# æå–è¾¹ç¼˜
gradient = cv2.morphologyEx(
    binary,
    cv2.MORPH_GRADIENT,
    kernel
)
		\end{lstlisting}

		\vspace{0.2cm}
		\begin{block}{å¯è§†åŒ–å¯¹æ¯”}
		\begin{itemize}
			\item åŸå§‹ï¼šæœ‰å™ªç‚¹çš„å¡«æ¶‚
			\item å¼€è¿ç®—ï¼šå¹²å‡€çš„å¡«æ¶‚
			\item é—­è¿ç®—ï¼šè¿æ¥çš„ç¬”è¿¹
			\item æ¢¯åº¦ï¼šæ¸…æ™°çš„è¾¹ç¼˜
		\end{itemize}
		\end{block}

		\vspace{0.2cm}
		\begin{center}
			\highlight{å½¢æ€å­¦æ“ä½œæ˜¯å›¾åƒé¢„å¤„ç†çš„"å¤–ç§‘æ‰‹æœ¯åˆ€"}
		\end{center}
	\end{columns}
\end{frame}
